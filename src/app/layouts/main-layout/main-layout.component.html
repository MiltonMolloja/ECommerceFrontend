<mat-sidenav-container class="sidenav-container">
  <!-- Mobile Drawer -->
  <mat-sidenav
    #mobileDrawer
    mode="over"
    position="start"
    class="mobile-drawer"
    (closed)="isMobileDrawerOpen.set(false)"
  >
    <!-- Drawer Header -->
    <div class="drawer-header">
      <div class="drawer-user-info">
        @if (authService.isAuthenticated()) {
          <mat-icon class="drawer-user-icon">account_circle</mat-icon>
          <span class="drawer-user-name">{{
            'HEADER.GREETING_USER' | translate: { name: userFirstName() }
          }}</span>
        } @else {
          <mat-icon class="drawer-user-icon">account_circle</mat-icon>
          <span class="drawer-user-name">{{ 'HEADER.GREETING' | translate }}</span>
        }
      </div>
      <button mat-icon-button (click)="closeMobileDrawer()" class="drawer-close-btn">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Drawer Content -->
    <div class="drawer-content">
      <!-- Navegación Principal -->
      <mat-nav-list>
        <a mat-list-item routerLink="/" (click)="closeMobileDrawer()">
          <mat-icon matListItemIcon>home</mat-icon>
          <span matListItemTitle>{{ 'HEADER.HOME' | translate }}</span>
        </a>
      </mat-nav-list>

      <mat-divider></mat-divider>

      <!-- Categorías (Expandible) -->
      <mat-accordion>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-icon class="panel-icon">category</mat-icon>
              {{ 'HEADER.CATEGORIES' | translate }}
            </mat-panel-title>
          </mat-expansion-panel-header>
          <mat-nav-list dense>
            @for (category of categories(); track category.categoryId) {
              <button
                mat-list-item
                type="button"
                (click)="navigateToCategoryAndClose(category.categoryId)"
              >
                <span matListItemTitle>{{ category.name }}</span>
                @if (category.productCount && category.productCount > 0) {
                  <span matListItemMeta class="category-count">({{ category.productCount }})</span>
                }
              </button>
            }
            <mat-divider></mat-divider>
            <a mat-list-item routerLink="/s" (click)="closeMobileDrawer()">
              <mat-icon matListItemIcon>apps</mat-icon>
              <span matListItemTitle>{{ 'HEADER.VIEW_ALL_CATEGORIES' | translate }}</span>
            </a>
          </mat-nav-list>
        </mat-expansion-panel>
      </mat-accordion>

      <mat-divider></mat-divider>

      <!-- Links de Navegación -->
      <mat-nav-list>
        @for (item of navigationItems; track item.labelKey) {
          <button
            mat-list-item
            type="button"
            (click)="navigateToAndClose(item.route, item.queryParams)"
          >
            <mat-icon matListItemIcon>{{ item.icon }}</mat-icon>
            <span matListItemTitle>{{ item.labelKey | translate }}</span>
          </button>
        }
      </mat-nav-list>

      <mat-divider></mat-divider>

      <!-- Cuenta -->
      <mat-nav-list>
        @if (authService.isAuthenticated()) {
          <button mat-list-item type="button" (click)="goToProfileAndClose()">
            <mat-icon matListItemIcon>person</mat-icon>
            <span matListItemTitle>{{ 'HEADER.MY_PROFILE' | translate }}</span>
          </button>
          <button mat-list-item type="button" (click)="logoutAndClose()">
            <mat-icon matListItemIcon>logout</mat-icon>
            <span matListItemTitle>{{ 'HEADER.LOGOUT' | translate }}</span>
          </button>
        } @else {
          <a mat-list-item routerLink="/login" (click)="closeMobileDrawer()">
            <mat-icon matListItemIcon>login</mat-icon>
            <span matListItemTitle>{{ 'HEADER.LOGIN' | translate }}</span>
          </a>
        }
      </mat-nav-list>

      <mat-divider></mat-divider>

      <!-- Configuración -->
      <div class="drawer-section-title">{{ 'HEADER.SETTINGS' | translate }}</div>
      <mat-nav-list>
        <!-- Tema -->
        <button mat-list-item type="button" (click)="setTheme('light')">
          <mat-icon matListItemIcon>light_mode</mat-icon>
          <span matListItemTitle>{{ 'THEME.LIGHT' | translate }}</span>
          @if (themeService.themeMode() === 'light') {
            <mat-icon matListItemMeta class="check-icon">check</mat-icon>
          }
        </button>
        <button mat-list-item type="button" (click)="setTheme('dark')">
          <mat-icon matListItemIcon>dark_mode</mat-icon>
          <span matListItemTitle>{{ 'THEME.DARK' | translate }}</span>
          @if (themeService.themeMode() === 'dark') {
            <mat-icon matListItemMeta class="check-icon">check</mat-icon>
          }
        </button>
        <button mat-list-item type="button" (click)="setTheme('auto')">
          <mat-icon matListItemIcon>brightness_auto</mat-icon>
          <span matListItemTitle>{{ 'THEME.AUTO' | translate }}</span>
          @if (themeService.themeMode() === 'auto') {
            <mat-icon matListItemMeta class="check-icon">check</mat-icon>
          }
        </button>
      </mat-nav-list>

      <mat-divider></mat-divider>

      <!-- Idioma -->
      <div class="drawer-section-title">{{ 'HEADER.LANGUAGE' | translate }}</div>
      <mat-nav-list>
        @for (lang of languageService.languages; track lang.code) {
          <button mat-list-item type="button" (click)="setLanguage(lang.code)">
            <span matListItemIcon class="language-flag">{{ lang.flag }}</span>
            <span matListItemTitle>{{ lang.name }}</span>
            @if (lang.code === languageService.currentLanguage()) {
              <mat-icon matListItemMeta class="check-icon">check</mat-icon>
            }
          </button>
        }
      </mat-nav-list>
    </div>
  </mat-sidenav>

  <!-- Main Content -->
  <mat-sidenav-content>
    <div class="layout-container">
      <!-- Header Principal - Amazon Style -->
      <header class="main-header">
        <!-- Primera fila: Logo, Búsqueda, Cuenta, Carrito -->
        <mat-toolbar class="top-toolbar">
          <div class="header-content">
            <!-- Botón Hamburguesa (solo móvil) -->
            <button
              mat-icon-button
              class="menu-button"
              (click)="openMobileDrawer()"
              aria-label="Abrir menú"
            >
              <mat-icon>menu</mat-icon>
            </button>

            <!-- Logo -->
            <a routerLink="/" class="logo">
              <mat-icon class="logo-icon">shopping_bag</mat-icon>
              <span class="logo-text hide-xs">ECommerce</span>
            </a>

            <!-- Barra de búsqueda con autocomplete -->
            <app-search-bar class="search-bar-wrapper"></app-search-bar>

            <!-- Badge de modo desarrollo -->
            @if (isDevMode) {
              <span class="dev-badge">DEV</span>
            }

            <!-- Acciones de header -->
            <div class="header-actions">
              <!-- Cuenta y listas -->
              <button mat-button class="account-button hide-xs" [matMenuTriggerFor]="accountMenu">
                <div class="account-info">
                  @if (userFirstName()) {
                    <span class="account-greeting">{{
                      'HEADER.GREETING_USER' | translate: { name: userFirstName() }
                    }}</span>
                  } @else {
                    <span class="account-greeting">{{ 'HEADER.GREETING' | translate }}</span>
                  }
                  <span class="account-label">{{ 'HEADER.ACCOUNT_LISTS' | translate }}</span>
                </div>
              </button>
              <mat-menu #accountMenu="matMenu">
                @if (authService.isAuthenticated()) {
                  <!-- Usuario logueado -->
                  <button mat-menu-item (click)="goToProfile()">
                    <mat-icon>person</mat-icon>
                    <span>{{ 'HEADER.MY_PROFILE' | translate }}</span>
                  </button>
                  <mat-divider></mat-divider>
                  <button mat-menu-item (click)="authService.logout()">
                    <mat-icon>logout</mat-icon>
                    <span>{{ 'HEADER.LOGOUT' | translate }}</span>
                  </button>
                } @else {
                  <!-- Usuario no logueado -->
                  <button mat-menu-item routerLink="/login">
                    <mat-icon>login</mat-icon>
                    <span>{{ 'HEADER.LOGIN' | translate }}</span>
                  </button>
                }
              </mat-menu>

              <!-- Solo icono de usuario en móvil -->
              @if (authService.isAuthenticated()) {
                <button mat-icon-button class="hide-gt-xs" (click)="goToProfile()">
                  <mat-icon>account_circle</mat-icon>
                </button>
              } @else {
                <button mat-icon-button class="hide-gt-xs" routerLink="/login">
                  <mat-icon>account_circle</mat-icon>
                </button>
              }

              <!-- Language Switcher -->
              <app-language-switcher></app-language-switcher>

              <!-- Selector de Tema -->
              <button mat-button class="theme-button hide-xs" [matMenuTriggerFor]="themeMenu">
                <div class="account-info">
                  <span class="account-greeting">{{ 'THEME.THEME_SETTINGS' | translate }}</span>
                  <span class="account-label">{{ themeService.getThemeLabel() }}</span>
                </div>
              </button>
              <mat-menu #themeMenu="matMenu">
                <button
                  mat-menu-item
                  (click)="setTheme('light')"
                  [class.active]="themeService.themeMode() === 'light'"
                >
                  <mat-icon>light_mode</mat-icon>
                  <span>{{ 'THEME.LIGHT' | translate }}</span>
                </button>
                <button
                  mat-menu-item
                  (click)="setTheme('dark')"
                  [class.active]="themeService.themeMode() === 'dark'"
                >
                  <mat-icon>dark_mode</mat-icon>
                  <span>{{ 'THEME.DARK' | translate }}</span>
                </button>
                <button
                  mat-menu-item
                  (click)="setTheme('auto')"
                  [class.active]="themeService.themeMode() === 'auto'"
                >
                  <mat-icon>brightness_auto</mat-icon>
                  <span>{{ 'THEME.AUTO' | translate }}</span>
                </button>
              </mat-menu>

              <!-- Icono de tema en móvil -->
              <button mat-icon-button class="hide-gt-xs" [matMenuTriggerFor]="themeMobileMenu">
                <mat-icon>{{ themeService.getThemeIcon() }}</mat-icon>
              </button>
              <mat-menu #themeMobileMenu="matMenu">
                <button
                  mat-menu-item
                  (click)="setTheme('light')"
                  [class.active]="themeService.themeMode() === 'light'"
                >
                  <mat-icon>light_mode</mat-icon>
                  <span>Claro</span>
                </button>
                <button
                  mat-menu-item
                  (click)="setTheme('dark')"
                  [class.active]="themeService.themeMode() === 'dark'"
                >
                  <mat-icon>dark_mode</mat-icon>
                  <span>Oscuro</span>
                </button>
                <button
                  mat-menu-item
                  (click)="setTheme('auto')"
                  [class.active]="themeService.themeMode() === 'auto'"
                >
                  <mat-icon>brightness_auto</mat-icon>
                  <span>{{ 'THEME.AUTO' | translate }}</span>
                </button>
              </mat-menu>

              <!-- Carrito (Estilo Amazon - Verde con contador naranja) -->
              <a routerLink="/cart" class="cart-button-amazon">
                <div class="cart-icon-wrapper">
                  @if (cartItemCount() > 0) {
                    <span class="cart-count-badge">{{ cartItemCount() }}</span>
                  }
                  <svg
                    class="cart-svg-icon"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M7 18C5.9 18 5.01 18.9 5.01 20C5.01 21.1 5.9 22 7 22C8.1 22 9 21.1 9 20C9 18.9 8.1 18 7 18ZM1 2V4H3L6.6 11.59L5.25 14.04C5.09 14.32 5 14.65 5 15C5 16.1 5.9 17 7 17H19V15H7.42C7.28 15 7.17 14.89 7.17 14.75L7.2 14.63L8.1 13H15.55C16.3 13 16.96 12.59 17.3 11.97L20.88 5.48C20.96 5.34 21 5.17 21 5C21 4.45 20.55 4 20 4H5.21L4.27 2H1ZM17 18C15.9 18 15.01 18.9 15.01 20C15.01 21.1 15.9 22 17 22C18.1 22 19 21.1 19 20C19 18.9 18.1 18 17 18Z"
                      fill="currentColor"
                    />
                  </svg>
                </div>
                <span class="cart-text-label">{{ 'HEADER.CART' | translate }}</span>
              </a>
            </div>
          </div>
        </mat-toolbar>

        <!-- Segunda fila: Navegación de categorías (oculta en móvil) -->
        <mat-toolbar class="nav-toolbar hide-xs">
          <div class="nav-content">
            <button mat-button class="nav-button" routerLink="/">
              <mat-icon>home</mat-icon>
              <span>{{ 'HEADER.HOME' | translate }}</span>
            </button>

            <!-- Menú desplegable de Categorías -->
            <button mat-button class="nav-button" [matMenuTriggerFor]="categoriesMenu">
              <mat-icon class="nav-icon">category</mat-icon>
              <span>{{ 'HEADER.CATEGORIES' | translate }}</span>
              <mat-icon class="dropdown-icon">arrow_drop_down</mat-icon>
            </button>
            <mat-menu #categoriesMenu="matMenu" class="categories-dropdown">
              @if (categories().length === 0) {
                <button mat-menu-item disabled>
                  <mat-icon>hourglass_empty</mat-icon>
                  <span>{{ 'HEADER.LOADING_CATEGORIES' | translate }}</span>
                </button>
              }
              @for (category of categories(); track category.categoryId) {
                <button mat-menu-item (click)="navigateToCategory(category.categoryId)">
                  <span>{{ category.name }}</span>
                  @if (category.productCount && category.productCount > 0) {
                    <span class="category-count">({{ category.productCount }})</span>
                  }
                </button>
              }
              @if (categories().length > 0) {
                <mat-divider></mat-divider>
                <button mat-menu-item routerLink="/s">
                  <mat-icon>apps</mat-icon>
                  <span>{{ 'HEADER.VIEW_ALL_CATEGORIES' | translate }}</span>
                </button>
              }
            </mat-menu>

            @for (item of navigationItems; track item.labelKey) {
              <button
                mat-button
                class="nav-button"
                (click)="navigateTo(item.route, item.queryParams)"
              >
                <mat-icon class="nav-icon">{{ item.icon }}</mat-icon>
                <span>{{ item.labelKey | translate }}</span>
              </button>
            }
          </div>
        </mat-toolbar>
      </header>

      <!-- Contenido principal -->
      <main class="content">
        <router-outlet></router-outlet>
      </main>

      <!-- Footer -->
      <footer class="footer">
        <div class="footer-content">
          <div class="footer-section">
            <h3>{{ 'FOOTER.ABOUT_US_TITLE' | translate }}</h3>
            <a href="#">{{ 'FOOTER.ABOUT_US' | translate }}</a>
            <a href="#">{{ 'FOOTER.CAREERS' | translate }}</a>
            <a href="#">{{ 'FOOTER.INVESTOR_RELATIONS' | translate }}</a>
          </div>
          <div class="footer-section">
            <h3>{{ 'FOOTER.EARN_MONEY_TITLE' | translate }}</h3>
            <a href="#">{{ 'FOOTER.SELL_ON_ECOMMERCE' | translate }}</a>
            <a href="#">{{ 'FOOTER.AFFILIATE_PROGRAM' | translate }}</a>
            <a href="#">{{ 'FOOTER.ADVERTISE_PRODUCTS' | translate }}</a>
          </div>
          <div class="footer-section">
            <h3>{{ 'FOOTER.HELP_TITLE' | translate }}</h3>
            <a href="#">{{ 'FOOTER.YOUR_ACCOUNT' | translate }}</a>
            <a href="#">{{ 'FOOTER.YOUR_ORDERS' | translate }}</a>
            <a href="#">{{ 'FOOTER.RETURNS_REPLACEMENTS' | translate }}</a>
          </div>
          <div class="footer-section">
            <h3>{{ 'FOOTER.PAYMENT_METHODS_TITLE' | translate }}</h3>
            <a href="#">{{ 'FOOTER.CREDIT_CARDS' | translate }}</a>
            <a href="#">{{ 'FOOTER.DEBIT_CARDS' | translate }}</a>
            <a href="#">{{ 'FOOTER.BANK_TRANSFER' | translate }}</a>
          </div>
        </div>
        <div class="footer-bottom">
          <p>{{ 'FOOTER.COPYRIGHT' | translate }}</p>
        </div>
      </footer>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
