<div class="cart-container">
  <!-- Header -->
  <div class="cart-header">
    <h1>{{ 'CART.TITLE' | translate }}</h1>
    @if (!isEmpty()) {
      <button mat-button color="warn" (click)="clearCart()">
        <mat-icon>delete_outline</mat-icon>
        {{ 'CART.CLEAR_CART' | translate }}
      </button>
    }
  </div>

  <!-- Empty State -->
  @if (isEmpty()) {
    <div class="empty-cart">
      <mat-icon class="empty-icon">shopping_cart</mat-icon>
      <h2>{{ 'CART.EMPTY_TITLE' | translate }}</h2>
      <p>{{ 'CART.EMPTY_MESSAGE' | translate }}</p>
      <button mat-raised-button color="primary" (click)="continueShopping()">
        {{ 'CART.CONTINUE_SHOPPING' | translate }}
      </button>
    </div>
  }

  <!-- Cart Content -->
  @if (!isEmpty()) {
    <div class="cart-content">
      <!-- Items List -->
      <div class="cart-items">
        <mat-card class="items-card">
          <mat-card-header>
            <mat-card-title>{{ 'CART.ITEMS' | translate }} ({{ itemCount() }})</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            @for (item of items(); track item.productId) {
              <div class="cart-item">
                <!-- Product Image -->
                <div class="item-image">
                  <img [src]="item.imageUrl" [alt]="item.name" />
                </div>

                <!-- Product Info -->
                <div class="item-info">
                  <h3 class="item-name">{{ item.name }}</h3>
                  @if (item.brand) {
                    <p class="item-brand">{{ item.brand }}</p>
                  }
                  <p class="item-stock" [class.out-of-stock]="!item.inStock">
                    @if (item.inStock) {
                      <mat-icon>check_circle</mat-icon>
                      {{ 'CART.IN_STOCK' | translate }}
                    } @else {
                      <mat-icon>cancel</mat-icon>
                      {{ 'CART.OUT_OF_STOCK_LABEL' | translate }}
                    }
                  </p>
                </div>

                <!-- Quantity Controls -->
                <div class="item-quantity">
                  <button
                    mat-icon-button
                    (click)="decrementQuantity(item.productId)"
                    [disabled]="item.quantity <= 1"
                  >
                    <mat-icon>remove</mat-icon>
                  </button>
                  <span class="quantity-value">{{ item.quantity }}</span>
                  <button mat-icon-button (click)="incrementQuantity(item.productId)">
                    <mat-icon>add</mat-icon>
                  </button>
                </div>

                <!-- Price -->
                <div class="item-price">
                  <p class="price">
                    {{ item.currency }}
                    {{ getItemSubtotal(item.price, item.quantity) | number: '1.2-2' }}
                  </p>
                  @if (item.quantity > 1) {
                    <p class="unit-price">
                      {{ item.currency }} {{ item.price | number: '1.2-2' }}
                      {{ 'CART.UNIT_PRICE' | translate }}
                    </p>
                  }
                </div>

                <!-- Remove Button -->
                <div class="item-actions">
                  <button
                    mat-icon-button
                    color="warn"
                    (click)="removeItem(item.productId, item.name)"
                    [attr.aria-label]="'CART.REMOVE_ITEM' | translate"
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>

              @if (!$last) {
                <mat-divider></mat-divider>
              }
            }
          </mat-card-content>
        </mat-card>

        <!-- Continue Shopping -->
        <button mat-stroked-button class="continue-shopping-btn" (click)="continueShopping()">
          <mat-icon>arrow_back</mat-icon>
          {{ 'CART.CONTINUE_SHOPPING' | translate }}
        </button>
      </div>

      <!-- Order Summary -->
      <div class="order-summary">
        <mat-card>
          <mat-card-header>
            <mat-card-title>{{ 'CART.ORDER_SUMMARY' | translate }}</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="summary-row">
              <span>{{ 'CART.SUBTOTAL' | translate: { count: itemCount() } }}</span>
              <span class="summary-value"
                >{{ items()[0]?.currency || 'USD' }} {{ totalAmount() | number: '1.2-2' }}</span
              >
            </div>

            <div class="summary-row">
              <span>{{ 'CART.SHIPPING' | translate }}</span>
              <span class="summary-value free">{{ 'CART.FREE' | translate }}</span>
            </div>

            <mat-divider></mat-divider>

            <div class="summary-row total">
              <span>{{ 'CART.TOTAL' | translate }}</span>
              <span class="summary-value"
                >{{ items()[0]?.currency || 'USD' }} {{ totalAmount() | number: '1.2-2' }}</span
              >
            </div>
          </mat-card-content>
          <mat-card-actions>
            <button
              mat-raised-button
              color="primary"
              class="checkout-btn"
              (click)="proceedToCheckout()"
            >
              {{ 'CART.PROCEED_TO_CHECKOUT' | translate }}
            </button>
          </mat-card-actions>
        </mat-card>

        <!-- Security Info -->
        <div class="security-info">
          <mat-icon>lock</mat-icon>
          <p>{{ 'CART.SECURE_PAYMENT' | translate }}</p>
        </div>
      </div>
    </div>
  }
</div>
