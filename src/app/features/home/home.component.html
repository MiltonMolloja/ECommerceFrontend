<div class="home-container">

  <!-- Estado de Error -->
  @if (error()) {
    <div class="error-state">
      <mat-icon class="error-icon">error_outline</mat-icon>
      <h2>Oops! Algo sali√≥ mal</h2>
      <p>{{ error() }}</p>
      <button mat-raised-button color="primary" (click)="retry()">
        <mat-icon>refresh</mat-icon>
        Reintentar
      </button>
    </div>
  }

  <!-- Estado de Carga -->
  @else if (isLoading()) {
    <div class="loading-state">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Cargando productos...</p>
    </div>
  }

  <!-- Contenido Principal -->
  @else {
    <!-- Hero Banner -->
    @if (banners().length > 0) {
      <section class="hero-section">
        <app-hero-banner [banners]="banners()" />
      </section>
    }

    <!-- Ofertas del D√≠a (con polling) -->
    @if (deals().length > 0) {
      <section class="deals-section">
        <div class="section-header">
          <h2>üî• Ofertas del D√≠a</h2>
          <p class="subtitle">Actualizadas cada minuto</p>
        </div>
        <app-product-carousel
          [products]="deals()"
          [viewAllLink]="'/s?hasDiscount=true'"
          (addToCart)="onAddToCart($event)"
        />
      </section>
    }

    <!-- Best Sellers -->
    @if (bestSellers().length > 0) {
      <section class="bestsellers-section">
        <div class="section-header">
          <h2>üèÜ Los M√°s Vendidos</h2>
        </div>
        <app-product-carousel
          [products]="bestSellers()"
          [viewAllLink]="'/s?sortBy=bestseller'"
          (addToCart)="onAddToCart($event)"
        />
      </section>
    }

    <!-- Productos Destacados -->
    @if (featuredProducts().length > 0) {
      <section class="featured-section">
        <div class="section-header">
          <h2>‚≠ê Productos Destacados</h2>
        </div>
        <app-product-carousel
          [products]="featuredProducts()"
          [viewAllLink]="'/s?isFeatured=true'"
          (addToCart)="onAddToCart($event)"
        />
      </section>
    }

    <!-- Novedades -->
    @if (newArrivals().length > 0) {
      <section class="new-arrivals-section">
        <div class="section-header">
          <h2>üÜï Reci√©n Llegados</h2>
        </div>
        <app-product-carousel
          [products]="newArrivals()"
          [viewAllLink]="'/s?sortBy=newest'"
          (addToCart)="onAddToCart($event)"
        />
      </section>
    }

    <!-- Mejor Valorados -->
    @if (topRated().length > 0) {
      <section class="top-rated-section">
        <div class="section-header">
          <h2>‚≠ê Mejor Valorados</h2>
          <p class="subtitle">4+ estrellas</p>
        </div>
        <app-product-carousel
          [products]="topRated()"
          [viewAllLink]="'/s?minRating=4&sortBy=rating'"
          (addToCart)="onAddToCart($event)"
        />
      </section>
    }

    <!-- Categor√≠as Destacadas -->
    @if (featuredCategories().length > 0) {
      <section class="categories-section">
        <div class="section-header">
          <h2>üìÇ Categor√≠as Destacadas</h2>
          <p class="subtitle">Explora nuestras categor√≠as m√°s populares</p>
        </div>
        <app-categories-grid [categories]="featuredCategories()" />
      </section>
    }

    <!-- Debug Info (solo en desarrollo) -->
    @if (metadata() && !isLoading()) {
      <div class="debug-metadata">
        <details>
          <summary>Debug Info</summary>
          <ul>
            <li><strong>Strategy:</strong> {{ loadStrategy() }}</li>
            <li><strong>From Cache:</strong> {{ metadata()?.fromCache ? 'S√≠' : 'No' }}</li>
            <li><strong>Execution Time:</strong> {{ metadata()?.queryExecutionTimeMs }}ms</li>
            <li><strong>Generated At:</strong> {{ metadata()?.generatedAt | date:'short' }}</li>
            <li><strong>Cache Age:</strong> {{ cacheInfo().age }}s</li>
            <li><strong>Cache Expires In:</strong> {{ cacheInfo().expiresIn }}s</li>
          </ul>
          <button mat-button (click)="clearCacheAndReload()">
            <mat-icon>delete</mat-icon>
            Clear Cache & Reload
          </button>
        </details>
      </div>
    }
  }
</div>
