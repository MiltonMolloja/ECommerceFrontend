<div class="home-container">
  <!-- Estado de Error -->
  @if (error()) {
    <div class="error-state">
      <mat-icon class="error-icon">error_outline</mat-icon>
      <h2>{{ 'HOME.ERROR_TITLE' | translate }}</h2>
      <p>{{ error() }}</p>
      <button mat-raised-button color="primary" (click)="retry()">
        <mat-icon>refresh</mat-icon>
        {{ 'HOME.RETRY' | translate }}
      </button>
    </div>
  }

  <!-- Estado de Carga -->
  @else if (isLoading()) {
    <div class="loading-state">
      <mat-spinner diameter="50"></mat-spinner>
      <p>{{ 'HOME.LOADING' | translate }}</p>
    </div>
  }

  <!-- Contenido Principal -->
  @else {
    <!-- Hero Banner -->
    @if (banners().length > 0) {
      <section class="hero-section">
        <app-hero-banner [banners]="banners()" />
      </section>
    }

    <!-- Ofertas del D√≠a (con polling) -->
    @if (deals().length > 0) {
      <section class="deals-section">
        <div class="section-header">
          <h2>üî• {{ 'HOME.DEALS_TITLE' | translate }}</h2>
          <p class="subtitle">{{ 'HOME.DEALS_SUBTITLE' | translate }}</p>
        </div>
        <app-product-carousel
          [products]="deals()"
          [viewAllLink]="'/s?hasDiscount=true'"
          [variant]="'deals'"
          (addToCart)="onAddToCart($event)"
        />
      </section>
    }

    <!-- Best Sellers -->
    @if (bestSellers().length > 0) {
      <section class="bestsellers-section">
        <div class="section-header">
          <h2>üèÜ {{ 'HOME.BESTSELLERS_TITLE' | translate }}</h2>
        </div>
        <app-product-carousel
          [products]="bestSellers()"
          [viewAllLink]="'/s?sortBy=bestseller'"
          [variant]="'bestseller'"
          (addToCart)="onAddToCart($event)"
        />
      </section>
    }

    <!-- Productos Destacados -->
    @if (featuredProducts().length > 0) {
      <section class="featured-section">
        <div class="section-header">
          <h2>‚≠ê {{ 'HOME.FEATURED_TITLE' | translate }}</h2>
        </div>
        <app-product-carousel
          [products]="featuredProducts()"
          [viewAllLink]="'/s?isFeatured=true'"
          [variant]="'featured'"
          (addToCart)="onAddToCart($event)"
        />
      </section>
    }

    <!-- Novedades -->
    @if (newArrivals().length > 0) {
      <section class="new-arrivals-section">
        <div class="section-header">
          <h2>üÜï {{ 'HOME.NEW_ARRIVALS_TITLE' | translate }}</h2>
        </div>
        <app-product-carousel
          [products]="newArrivals()"
          [viewAllLink]="'/s?sortBy=newest'"
          [variant]="'new'"
          (addToCart)="onAddToCart($event)"
        />
      </section>
    }

    <!-- Mejor Valorados -->
    @if (topRated().length > 0) {
      <section class="top-rated-section">
        <div class="section-header">
          <h2>‚≠ê {{ 'HOME.TOP_RATED_TITLE' | translate }}</h2>
          <p class="subtitle">{{ 'HOME.TOP_RATED_SUBTITLE' | translate }}</p>
        </div>
        <app-product-carousel
          [products]="topRated()"
          [viewAllLink]="'/s?minRating=4&sortBy=rating'"
          [variant]="'top-rated'"
          (addToCart)="onAddToCart($event)"
        />
      </section>
    }

    <!-- Categor√≠as Destacadas -->
    @if (featuredCategories().length > 0) {
      <section class="categories-section">
        <div class="section-header">
          <h2>üìÇ {{ 'HOME.CATEGORIES_TITLE' | translate }}</h2>
          <p class="subtitle">{{ 'HOME.CATEGORIES_SUBTITLE' | translate }}</p>
        </div>
        <app-categories-grid [categories]="featuredCategories()" />
      </section>
    }

    <!-- Debug Info (solo en desarrollo) -->
    @if (metadata() && !isLoading()) {
      <div class="debug-metadata">
        <details>
          <summary>Debug Info</summary>
          <ul>
            <li><strong>Strategy:</strong> {{ loadStrategy() }}</li>
            <li><strong>From Cache:</strong> {{ metadata()?.fromCache ? 'S√≠' : 'No' }}</li>
            <li><strong>Execution Time:</strong> {{ metadata()?.queryExecutionTimeMs }}ms</li>
            <li><strong>Generated At:</strong> {{ metadata()?.generatedAt | date: 'short' }}</li>
            <li><strong>Cache Age:</strong> {{ cacheInfo().age }}s</li>
            <li><strong>Cache Expires In:</strong> {{ cacheInfo().expiresIn }}s</li>
          </ul>
          <button mat-button (click)="clearCacheAndReload()">
            <mat-icon>delete</mat-icon>
            {{ 'HOME.CLEAR_CACHE' | translate }}
          </button>
        </details>
      </div>
    }
  }
</div>
