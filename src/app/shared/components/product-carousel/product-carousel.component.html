<section class="product-carousel" [attr.data-variant]="variant()">
  <div class="carousel-header">
    @if (viewAllLink()) {
      <a
        (click)="navigateToViewAll()"
        (keydown.enter)="navigateToViewAll()"
        tabindex="0"
        role="link"
        class="view-all-link"
      >
        {{ 'PRODUCT.VIEW_ALL' | translate }}
        <mat-icon>arrow_forward</mat-icon>
      </a>
    }
    <div class="nav-buttons">
      <button
        mat-icon-button
        class="nav-btn"
        (click)="scrollLeft()"
        [disabled]="products().length === 0"
        [attr.aria-label]="'PRODUCT.PREVIOUS' | translate"
      >
        <mat-icon>chevron_left</mat-icon>
      </button>
      <button
        mat-icon-button
        class="nav-btn"
        (click)="scrollRight()"
        [disabled]="products().length === 0"
        [attr.aria-label]="'PRODUCT.NEXT' | translate"
      >
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>
  </div>

  @if (products().length > 0) {
    <div class="carousel-track" #carouselTrack>
      @for (product of products(); track trackByProductId($index, product)) {
        <mat-card class="product-card" [routerLink]="getProductLink(product)">
          <!-- Badges segÃºn variante -->
          <div class="badges-container">
            @if (variant() === 'deals' && hasDiscount(product)) {
              <div class="discount-badge-large">
                <span class="discount-percent">-{{ getDiscountPercentage(product) }}%</span>
                <span class="discount-label">OFF</span>
              </div>
            }

            @if (variant() === 'bestseller') {
              <div class="ranking-badge">
                <mat-icon>emoji_events</mat-icon>
                <span>#{{ $index + 1 }}</span>
              </div>
            }

            @if (variant() === 'featured') {
              <div class="featured-badge">
                <mat-icon>star</mat-icon>
                <span>{{ 'PRODUCT.FEATURED' | translate }}</span>
              </div>
            }

            @if (variant() === 'new') {
              <div class="new-badge">
                <mat-icon>fiber_new</mat-icon>
                <span>{{ 'PRODUCT.NEW' | translate }}</span>
              </div>
            }

            @if (variant() === 'top-rated' && product.averageRating) {
              <div class="rating-badge-large">
                <mat-icon>star</mat-icon>
                <span>{{ product.averageRating | number: '1.1-1' }}</span>
              </div>
            }
          </div>

          <div class="product-image-container">
            <img
              [src]="getProductImage(product)"
              [alt]="product.name"
              class="product-image"
              loading="lazy"
            />
          </div>

          <mat-card-content class="product-content">
            <h3 class="product-name" [title]="product.name">
              {{ product.name }}
            </h3>

            @if (product.averageRating && product.averageRating > 0) {
              <div class="rating">
                @for (star of getStars(product.averageRating); track $index) {
                  <mat-icon class="star" [class.filled]="star === 1">
                    {{ star === 1 ? 'star' : 'star_border' }}
                  </mat-icon>
                }
                @if (product.totalReviews && product.totalReviews > 0) {
                  <span class="reviews">({{ product.totalReviews }})</span>
                }
              </div>
            }

            <div class="prices">
              <span class="price">${{ product.price.toFixed(2) }}</span>
              @if (hasDiscount(product)) {
                <span class="original-price"> ${{ getOriginalPrice(product).toFixed(2) }} </span>
              }
            </div>

            @if (hasDiscount(product) && variant() === 'deals') {
              <div class="savings-large">
                <mat-icon>trending_down</mat-icon>
                <span>{{ 'PRODUCT.SAVE' | translate }} ${{ getSavings(product).toFixed(2) }}</span>
              </div>
            } @else if (hasDiscount(product)) {
              <div class="savings">
                {{ 'PRODUCT.SAVE' | translate }} ${{ getSavings(product).toFixed(2) }}
              </div>
            }

            <button
              mat-raised-button
              color="primary"
              class="add-to-cart"
              (click)="onAddToCart(product, $event)"
            >
              <mat-icon>shopping_cart</mat-icon>
              {{ 'PRODUCT.ADD_TO_CART' | translate }}
            </button>
          </mat-card-content>
        </mat-card>
      }
    </div>
  } @else {
    <div class="empty-state">
      <mat-icon>inventory_2</mat-icon>
      <p>{{ 'PRODUCT.NO_PRODUCTS' | translate }}</p>
    </div>
  }
</section>
